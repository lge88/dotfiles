#!/usr/bin/env node

require('shelljs/global');
var path = require('path');
var dbFile = path.resolve( __dirname, '../lib/package.json' );

var config = {
  name: 'toolkit',
  version: '0.0.1'
};

var str = exec( 'npm ls -g --parseable --depth=0 2> /dev/null | awk -F/ \'NR>1 {print $NF}\'', { silient: true } ).output;

var locals = [
  'interpreter.js',
  'three-math',
  'three-build'
];

config.dependencies = str
  .trim().split( '\n' )
  .filter( function( item ) {
    return locals.indexOf( item ) === -1;
  } )
  .reduce( function( sofar, item ) {
    sofar[ item ] = "latest";
    return sofar;
  }, {} );

JSON.stringify( config, null, 2 ).to( dbFile );
